<!DOCTYPE html>

<head>
  <meta charset="utf8">
  <title>Topi Ikonen</title>
  <link rel="stylesheet" href="/css/mystyles.css">
  <link rel="stylesheet" href="/css/prism.css">
  <link rel="stylesheet" href="/css/styles.css">


</head>

<body>

  <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">

      <a class="navbar-item" href="index.html">
        Topi Ikonen
      </a>


      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="index.html">
          Etusivu
        </a>

        <a class="navbar-item is-active" href="tekniikka.html">
          Tekniikka
        </a>

        <a class="navbar-item" href="productowner.html">
          Product Owner
        </a>

        <a class="navbar-item" href="muut.html">
          Muut tehtävät
        </a>

        <a class="navbar-item" href="reflektio.html">
          Reflektio
        </a>

      </div>



      <div class="navbar-end">
        <a class="navbar-item" href="/audioportfolio/">
          Audioportfolio
        </a>
      </div>
    </div>
  </nav>

  <div class="header">
    <h1 class="title is-1">tekniikka</h1>
  </div>

  <div class="content">
    <div class="block">
      <h4 class="title is-3">teknologiat</h4>

      <p>Listaus teknologioista ja työkaluista, joiden parissa työskentelin projektin aikana</p>
      <div class="columns">

        <div class="column">
          <div class="tech-img-container">
            <img class="tech" src="media/Angular_full_color_logo.svg.png" width=150px>
          </div>
          <div class="tech-title">Angular</div>
          <ul>
            <li>HTML5</li>
            <li>Typescript</li>
            <li>CSS3</li>
          </ul>
        </div>
        <div class="column">
          <div class="tech-img-container">
            <img class="tech" src="media/1200px-TensorFlowLogo.svg.png" width=150px>
          </div>
          <div class="tech-title">TensorFlow</div>
          <ul>
            <li>Äänimallien luominen</li>
            <li>Äänitunnistuksen implementointi sovellukseen</li>
            <li><a href="https://teachablemachine.withgoogle.com/">Teachable Machine</a></li>
          </ul>
        </div>
        <div class="column">
          <div class="tech-img-container">
            <img class="tech wide" src="media/1200px-MySQL-n_logo.svg.png" width=150px>
          </div>
          <div class="tech-title">MySQL</div>
          <ul>
            <li>Tietokantojen mallintaminen</li>
            <li>SQL-skriptien kirjoittaminen</li>
            <li>PHPMyAdmin</li>
          </ul>
        </div>

      </div>

      <div class="columns">


        <div class="column">
          <div class="tech-img-container">
            <img class="tech wide" src="media/1200px-Node.js_logo.svg.png" width=150px>
          </div>
          <div class="tech-title">node.js</div>
          <ul>
            <li><a href="https://sequelize.org/">Sequelize.js</a></li>
            <li>Tietokantamallien rakentaminen</li>
            <li>Tietokantapyyntöjen rakentaminen</li>
          </ul>
        </div>
        <div class="column">
          <div class="tech-img-container">
            <img class="tech" src="media/141_Git_logo_logos-512.png" width=150px>
          </div>
          <div class="tech-title">Git</div>
          <ul>
            <li>Github</li>
            <li>Zenhub</li>
            <li>Versionhallinta ohjelmistoprojektissa</li>
          </ul>
        </div>
        <div class="column">
          <div class="tech-img-container">
            <img class="tech" src="media/application-window.png" width=150px>
          </div>
          <div class="tech-title">Muut sovellukset yms</div>
          <ul>
            <li>Visual Studio Code</li>
            <li>Github Desktop</li>
            <li>Da Vinci Resolve</li>
            <li>Discord</li>
            <li>Bulma.io</li>
            <li>Sass</li>
          </ul>
        </div>
      </div>

    </div>

    <div class="block">
      <h4 class="title is-3">harjoitteet</h4>
      <p>Harjoitteet ovat yksi Acornin tärkeimpiä elementtejä ja minä olin täysin vastuussa niiden toiminnallisuudesta.
        Tässä kappalessa avaan harjoitteiden toteutustapaa- ja prosessia.</p>

      <h4 class="title is-4">tensorflow</h4>
      <p>Toteutusta aloittaessa minulla ei ollut minkäännäköistä käsitystä siitä, kuinka äänitunnistusta pitäisi alkaa
        rakentaa. Tensorflow tuntui järkevältä ratkaisulta, mutta tässäkin tuli vastaan ongelma, että kuinka
        äänimalleja on helppo luoda. Onnekseni törmäsin Teachable Machineen, joka on yksinkertainen käyttöliittymä kuva-
        ja äänimallien luomiseen.
      </p>

      <div class="columns">
        <div class="column">
          <img class="zoom" src="/media/tensorflow1.png">


        </div>
        <div class="column">
          <p>
            Teachable Machineen nauhoitetaan haluttu määrä sampleja per luokka ja se luo automaattisesti niistä
            Tensorflow-mallin. Demossa on käytetty Tensorflowin
            puheentunnistus-toiminnallisuutta, sillä sen sai tunnistamaan tarpeellisella tarkkuudella myös kitaran
            ääntä. Jatkokehitystä ajatellen sovellukseen olisi
            hyvä rakentaa alusta asti täysin oma malli. Teachable Machinella on jaossa oma koodinpätkä, jonka avulla
            sain mallin toimimaan Angular-sovelluksessa miltein vaivattomasti.

          </p>


        </div>


      </div>


      <h4 class="title is-4">käytännön toteutus</h4>


      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'practice.service.ts', 'tabcontent1')"
          id="defaultOpen">practice.service.ts</button>
        <button class="tablinks" onclick="openTab(event, 'Practice.js', 'tabcontent1')">Practice.js</button>
        <button class="tablinks"
          onclick="openTab(event, 'practicecontroller.js', 'tabcontent1')">practicecontroller.js</button>
        <button class="tablinks"
          onclick="openTab(event, 'practice.component.ts', 'tabcontent1')">practice.component.ts</button>
      </div>

      <!-- Tab content -->
      <div id="practice.service.ts" class="tabcontent1">
        <p class="tabinfo">Service, jolla haetaan valitun tutoriaalin perusteella kyseisen tutoriaalin harjoitteet
          tietokannasta</p>
        <pre><code class="language-typescript">
    export class PracticeService {
      private practicesUrl = 'http://localhost:3000/tutorials/practices/';
      practices: Array<Practicedatatype> = [];
      tutorial: number;
    
      // Virheenkäsittely
      private handleError(error: any): Observable<any> {
        console.error('An error occurred', error);
        return (error.message || error);
      }
    
      // Metodi, jolla haetaan kannasta halutut practicet klikatun tutoriaalivalikon itemin perusteella
      // input-muuttuja on tutorial-olion id
      getPractices(input): Observable<Practicedatatype[]> {
        this.tutorial = input
        console.log(this.tutorial + " t service");
        
        return this.http.get<Practicedatatype[]>(this.practicesUrl + this.tutorial)
          .pipe(
            catchError(this.handleError)
        );
      }
    
    
      constructor(private http: HttpClient) { }
    }
  </code></pre>
      </div>

      <div id="Practice.js" class="tabcontent1">
        <p class="tabinfo">Backendissä sijaitseva Practice-olioiden tietotyypin alustusfunktio</p>
        <pre>
    <code class="language-typescript">
const { Sequelize, DataTypes } = require('sequelize');
const sequelize = require('../dbconnection');

const Practice = sequelize.define('Practice', {
    practice: {
        type: DataTypes.INTEGER,
        allowNull: false,
        primaryKey: true
    },
    title: {
        type: DataTypes.STRING,
        allowNull: false
    },
    instructions: {
        type: DataTypes.STRING,
        allowNull: false
    },
    model: {
        type: DataTypes.STRING,
        allowNull: false
    },
    modelclass: {
        type: DataTypes.INTEGER,
        allowNull: false
    },
    confidence: {
        type: DataTypes.FLOAT,
        allowNull: false
    },
    media: {
        type: DataTypes.STRING,
        allowNull: false
    },
    tutorial: {
        type: DataTypes.INTEGER,
        allowNull: true
    }
}, {
    freezeTableName: true
});

module.exports = Practice;
    </code>
  </pre>
      </div>

      <div id="practicecontroller.js" class="tabcontent1">
        <p class="tabinfo">Metodi, jolla haetaan kaikki harjoitteet tietokannasta. Jälkeenpäin ajateltuna fiksumpi ratkaisu olisi hakea tutorialin numerolla
          harjoitteet, eikä kerralla kaikkia.
        </p>
        <pre>
  <code class="language-typescript">

const Practice = require('../models/Practice');

const practicecontroller = {
    findAll: (req, res) => {
        Practice.findAll().then((practices) => {
            res.json(practices);
        }).catch((err) => {
            console.log(err);
        });
    },
};

module.exports = practicecontroller;
  </code>
</pre>
      </div>

      <div id="practice.component.ts" class="tabcontent1">
        <p class="tabinfo">Frontend-luokka, joka hoitaa kaiken toiminnallisuuden harjotteista.</p>
        <pre><code class="language-typescript">
          export class PracticeComponent implements OnInit {
            model: string; // tähän ominaisuuteen tallennetaan haluttu AI-malli
            tutorial: number; // tähän ominaisuuteen kirjataan ylös mikä harjoitesarja on kyseessä
            target: number = 0; // tätä käytetään oikean luokan valitsemiseen koneoppimismallista
            practiceModels: number[]; // tällä tarkistetaan missä kohdin ollaan menossa practices-arrayssä
            practiceConfidence: number[]; // tällä seurataan harjoitteiden confidencea
            current: number = 0; // tällä tarkistetaan missä kohdin ollaan menossa practiceModels-arrayssä
            correct: boolean = false; // tällä tarkistetaan onko harjoite mennyt oikein
            started: boolean = false; // tällä tarkistetaan onko harjoitus aloitettu
            practicing: boolean = false; // tällä tarkistetaan onko harjoitus käynnissä
            finished: boolean = false; // tällä tarkistetaan onko harjoitus loppu
            practices: Practicedatatype[]; //tähän haetaan tietokannasta harjoitteet
            completed: number = 0; //tämä pitää kirjaa suoritetuista harjotteista
            confidence: number = 0.5; //tämä määrittää kuinka suurella prosentilla sisääntulevan äänen täytyy täsmätä malliin
            correctAudio: string = '../../assets/audio/acorn_correct.wav'; //ääniefekti oikealle vastaukselle
            user: Userdatatype;
            levelup: boolean = false;
            feedbackList: Feedbackdatatype[];
            randomFeedbackIndex: number;
            private wrongSignals: number = 0; //väärien signaalien määrä, viidestä tulee penalty
            private penalties: number = 0; //penaltyjen määrä, jokaisesta kaksi expaa pois
            public trueExp: number; //lopullinen expa mikä annetaan käyttäjälle
            public penalty: boolean; //ilmoittaa käyttäjälle jos tulee penalty
          
            //BUGIT
            //äänitunnistus jää päälle jos komponentista siirrytään pois kesken harjoitteen
            
          
            constructor(
              private practiceService: PracticeService,
              public messageService: MessageService,
              public userService: UserService,
              public progressionService: ProgressionService,
              public authService: AuthService,
              public equipService: EquipService
            ) {}
          
            async ngOnInit() {
              await this.getPractices();
              this.getFeedback();
              this.getUser();
              await this.delay(2500);
              this.init();
            }
          
            //hakee practicet tietokannasta
            getPractices(): void {
              this.practiceService
                .getPractices(this.messageService.tutorial.tutorial)
                .subscribe((practices) => (this.practices = practices));
            }
          
              // Hakee userServicen kautta tietokannasta käyttäjäolion ja sijoittaa sen user-olioon.
            getUser(): void {
              const userid = parseInt(sessionStorage.getItem('userid'));
              console.log(userid);
              this.userService.getUser(userid)
                .subscribe(user => this.user = user);
              
            }
          
              // ProgressionServicen välityksellä päivittää käyttäjän expat, ottaa arvoiksi halutun käyttäjän ja annetut expat
            updateUserExperience(user, experienceReward): void {
              this.progressionService.updateExperience(user, experienceReward)
                .subscribe((users) => this.user);
            }
          
            // Haetaan feedbackList- tauluun kannasta kaikki kehut
            getFeedback(): void {
              this.messageService.getAllFeedback()
                .subscribe((feedback) => this.feedbackList = feedback);
            }
          
            // Arvotaan random numero, jota käytetään feedbackListin yhteydessä indexinumerona jotta saadaan yksi satunnainen kehu
            pickOneFeedbackIndex(): void {
              let random = Math.floor(Math.random() * this.feedbackList.length);
              this.randomFeedbackIndex = random;
            }
          
            // asettaa halutun oppimismallin äänitunnistukselle
            setModel() {
              this.tutorial = this.messageService.tutorial.tutorial;
              console.log(this.tutorial + " terv setModel() ennen looppia")
          
            //alustetaan apumuuttuja, johon haetaan harjoitteet
              let practiceSet = [];
            //alustetaan apumuuttuja, joka johon haetaan AI:n mallin classi
              let practiceModels = [];
          
              let practiceConfidence = [];
            //iteroidaan tietokannasta haetut harjoitteet läpi
              for (let i = 0; i < this.practices.length; i++) {
                  //pusketaan ne practiceSet-muuttujaan
                  practiceSet.push(this.practices[i]);
                  console.log(JSON.stringify(this.practices[i]) + " terveisin forloop")
                  //pusketaan mallien luokat practiceModels-muuttujaan
                  practiceModels.push(this.practices[i].modelclass);
                  //pusketaan mallien tarkkuudet practiceConfidenceen
                  practiceConfidence.push(this.practices[i].confidence);
                 }
              
              //asetetaan apumuuttujat luokkamuuttujiin
              this.practices = practiceSet;
              console.log("setModel() " + this.practices);
              this.practiceModels = practiceModels;
              console.log("practicemodelit " + this.practiceModels );
              this.practiceConfidence = practiceConfidence;
              console.log("practiceConfidencet " + practiceConfidence);
              this.target = this.practiceModels[this.current];
              console.log("target " + this.target);
              this.confidence = this.practiceConfidence[this.current];
          
              //asetetaan koneppismismalli, jota kyseisessä harjoitteessa käytetään
              this.model = this.practices[0].model;
            }
          
            playAudio(src) {
              let audio = new Audio(src);
              console.log(audio);
              audio.play();
            }
          
            //tällä voidaan automaattisesti triggeroida nextPractice() tietyn ajan jälkeen
            private delay(ms: number) {
              return new Promise((resolve) => setTimeout(resolve, ms));
            }
          
            nextPractice() {
              // nappia painamalla siirrytään seuraavaan harjoitteeseen
              this.correct = false;
              this.penalty = false;
              this.wrongSignals = 0;
              console.log("target ennen currenttia" + this.target);
              
              this.completed++;
              this.pickOneFeedbackIndex();
              
              //siirrytään seuraavaan harjoitteeseen
              this.current++;
              this.target = this.practiceModels[this.current];
              this.confidence = this.practiceConfidence[this.current];
              console.log("target currentin jälkeen" + this.target);
          
              console.log(this.practices);
            }
          
            async createModel() {
              // alustaa äänimallin
              this.setModel();
              const checkpointURL = this.model + 'model.json'; // model topology
              const metadataURL = this.model + 'metadata.json'; // model metadata
          
              const recognizer = speechCommands.create(
                'BROWSER_FFT', // fourier transform type, not useful to change
                undefined, // speech commands vocabulary feature, not useful for your models
                checkpointURL,
                metadataURL
              );
          
              // check that model and metadata are loaded via HTTPS requests.
              await recognizer.ensureModelLoaded();
              return recognizer;
            }
          
            async init() {
              //ilmoitetaan komponentille että harjoitus alkaa
              this.started = true;
              this.practicing = true;
              this.pickOneFeedbackIndex();
              const recognizer = await this.createModel();
              const classLabels = recognizer.wordLabels(); // get class labels
          
              //aloittaa kuuntelun
              recognizer.listen(
                async (result) => {
                  const scores = result.scores; //ottaa AI-mallista kuunnellessa eri classien todennäköisyydet taulukkoon talteen
          
          
                  console.log(classLabels[this.target]);
                  console.log(classLabels[0]);
                  console.log(scores[this.target]);
          
                  //jos harjoite menee oikein siirrytään seuraavaan
                  if (scores[this.target] > this.confidence) {
          
                    
                    console.log('oikein :d');
                    //confidence nostetaan hetkittäisesti korkealle jotta ääniefekti ei looppaa toistuvista oikeista vastauksista
                    this.confidence = 1.1;
                    this.playAudio(this.correctAudio);
                    this.penalty = false;
                    this.correct = true;
                    await this.delay(2500);
                    this.nextPractice();
                  }
          
                  if (scores[this.target] < this.confidence && scores[0] < 0.1) {
                    console.log("viärä vastaus");
                    this.wrongSignals++;
                    console.log("wrongSignals " + this.wrongSignals);
                    if (this.wrongSignals === 5) {
                      this.wrongSignals = 0;
                      this.penalties++;
                      console.log("penaalit" + this.penalties);
                      this.penalty = true;
                    }
          
                  }
          
                  //tarkistetaan onko harjoitteita suoritettu enemmän, kuin niitä on
                  if (this.completed === this.practices.length) {
                    //this.practicing = false; 
                    this.finished = true;
                    let currency = this.user.currency + this.messageService.tutorial.reward;
                    this.userService.updateCurrency(this.user, currency).subscribe();
                    let expPenalty = this.penalties * 3;
                    this.trueExp = this.messageService.tutorial.rewardxp - expPenalty;
                    this.updateUserExperience(this.user, this.trueExp);
                    if (this.user.experience + this.messageService.tutorial.rewardxp > 50) {
                      this.levelup = true;
                    }
                    recognizer.stopListening();
                    console.log('init() ' + this.practices);
                  }
                },
                {
                  includeSpectrogram: true, // in case listen should return result.spectrogram
                  probabilityThreshold: 0.75,
                  invokeCallbackOnNoiseAndUnknown: true,
                  overlapFactor: 0.5, // probably want between 0.5 and 0.75. More info in README
                }
              );
          
              // Stop the recognition in 5 seconds.
              // setTimeout(() => recognizer.stopListening(), 5000);
            }
          }</code></pre>
      </div>



      -kerro toimintalogiikasta <br />
      -mainitse myös backend <br />
      -ongelmat äänimallien nauhoituksessa <br />
      -mitä tästä opittiin
    </div>

    <div class="block">
      <h4 class="title">inventaario</h4>
      -kerro toimintalogiikasta <br />
      -kerro asioiden siirtämisestä serviceihin ja hypetä positiivisena oppimiskokemuksena<br />
      -kerro backendistä<br />
      -
    </div>

    <div class="block">
      <h4 class="title">muut tekniset tehtävät</h4>
      -muiden ryhmäläisten auttaminen teknisissä tehtävissä <br />
      -muiden opastaminen angularin kanssa <br />
      -tietokanta <br />
    </div>

    <div class="block">
      <h4 class="title">asiat joita jäi käteen</h4>
      -angular-sovelluksen toiminnan hahmottaminen<br />
      -fullstack-sovelluksen toiminnan hahmottaminen <br />

    </div>

  </div>

  <footer class="footer">
    <div class="content has-text-centered">
      &copy; Topi Ikonen
    </div>
  </footer>
  <script src="./js/prism.js"></script>
  <script src="./js/scripts.js"></script>
  <script>
    document.getElementById("defaultOpen").click();
  </script>
</body>

</html>